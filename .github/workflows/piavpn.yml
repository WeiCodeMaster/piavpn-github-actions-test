name: Rumble Visit with VPN in Container

on:
  push:
  schedule:
    - cron: '*/5 * * * *'
  workflow_dispatch:
    inputs:
      video_url:
        description: 'Rumble Video URL'
        required: true
        default: 'https://rumble.com/v6r0vz6-automate.html'

jobs:
  rumble-vpn:
    runs-on: ubuntu-latest
    container:
      image: ubuntu:latest
      options: --privileged --security-opt seccomp=unconfined --security-opt apparmor=unconfined
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Install Essential Dependencies
        run: |
          apt update
          apt install -y curl wget sudo iproute2 apt-transport-https gnupg ca-certificates
          curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
          apt install -y nodejs
          apt install -y fonts-liberation libatk-bridge2.0-0 libatk1.0-0 libatspi2.0-0 libcups2 libdbus-1-3 libgbm1 libgtk-3-0 libnspr4 libnss3 libpango-1.0-0 libx11-6 libxcb1 libxcomposite1 libxdamage1 libxext6 libxfixes3 libxrandr2 libxshmfence1 libxss1 libasound2t64 libpulse0 libxkbcommon0 xdg-utils lsb-release libasound2-plugins

      - name: Install and Connect PIA
        env:
          PIA_USERNAME: ${{ secrets.PIA_USERNAME }}
          PIA_PASSWORD: ${{ secrets.PIA_PASSWORD }}
        run: |
          echo "Downloading PIA client..."
          curl -L -o pia.deb https://installers.privateinternetaccess.com/download/pia-linux.deb
          sudo dpkg -i pia.deb || sudo apt-get install -f -y
          # Optionally verify installation
          which piactl || { echo "piactl not found. Exiting."; exit 1; }
          echo "Logging into PIA..."
          sudo piactl login "$PIA_USERNAME" "$PIA_PASSWORD"
          echo "Connecting to PIA..."
          sudo piactl connect
          sleep 10

      - name: Install Puppeteer Dependencies
        run: |
          npm init -y
          npm install puppeteer puppeteer-core puppeteer-extra puppeteer-extra-plugin-stealth

      - name: Create Puppeteer Script for Rumble
        run: |
          mkdir -p scripts screenshots
          cat > scripts/rumble-visit.js << 'EOF'
          const puppeteer = require('puppeteer-extra');
          const StealthPlugin = require('puppeteer-extra-plugin-stealth');
          const fs = require('fs');
          const { execSync } = require('child_process');

          puppeteer.use(StealthPlugin());

          function sleep(ms) {
              return new Promise(resolve
